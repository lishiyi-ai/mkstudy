数据链路层使用的信道主要有以下两种类型：
点对点信道，广播信道。
本章最重要内容：
	**点对点信道**和**广播信道**的**特点**。**PPP协议** 和 **CSMA/CD协议** 的**特点**。
	==三个基本问题==：**封装成帧**、**透明传输** 和 **差错检测**。
	以太网MAC层的**硬件地址**。
	**适配器**、**转发器**、**集线器**、**网桥**、**以太网交换机**的作用以及使用场合。

## 数据链路层的几个问题

#### 数据链路和帧

**链路**：就是从一个节点到相邻节点的一段**物理线路**。
**数据链路**：实现**通信协议的硬件** 和 **软件**加到链路上，就构成了**数据链路**。最常用的就是**网络适配器**。
早期的数据通信曾叫做通信**规程**

**帧**：数据链路层的协议数据单元。网络层协议数据单元就是**IP数据报**。

数据链层在进行通信时**主要步骤**是：分装成帧，帧转发，差错检测，交给网络层。

#### 三个基本问题

**==封装成帧==**
	就是在一段数据的前后分别**添加首部和尾部**。首部和尾部的一个重要作用就是**帧定界**。**帧开始符SOH**，**帧结束符EOT**。
	每一种链路层协议都规定了所能传送的帧的数据部分长度上限——**最大传送单元MTU**。

**==透明传输==**
	为了防止数据中的二进制代码恰好和控制符一样，我们需要采用透明传输。
	**具体方法**：
		发送端的数据链路层在数据中出现控制字符"SOH"或"EOT"的前面**插入一个转移字符"ESC"**。
		而在接收端的数据链路层在把数据**送往**网络层之前**删除这个插入的转义字符**。
		转义字符出现在数据中则在其前面 也插入转义字符。

**==差错检测==**
	数据链路层广泛使用了**==循环冗余检验CRC==**的检错技术。这种为了进行检错而添加的**冗余码**常称为**帧检验序列FCS**。
	事先要确定一个除数(n+1)P，通过M / P得到**余数R**，M + P构成的就是**FCS**。 
	接收端对收到的每一帧经过CRC检验后，有以下两种情况：
		1.R＝0，就接受。2.R != 0，就丢弃。
	凡是接收端数据链路层接受的帧，我们都能以非常接近与1的概率认为这些帧在传输过程中没有产生差错。
	**传输差错分类**：
		1.比特差错
		2.帧丢失，帧重复 或 帧失序。
			OSI在CRC的基础上增加了：**==帧编号**，**确认** 和 **重传机制==**。

## 点对点协议PPP 只支持全双工

#### PPP协议的特点

**PPP协议应满足的需求**：
	简单、封装成帧，透明性，多种网络层协议，多种类型链路、差错检测、最大传送单元、网络层地址协商、数据压缩协商。

**ppp协议的组成**：
	1.一个将IP数据包封装成到串行链路的方法。
	2.一个用来建立、配置和测试数据链路连接的**链路控制协议LCP**。
	3.一套**网络控制协议NCP**。

#### PPP协议的帧格式

**各字段的意义**：
	1.首部：**4字节**，F标志字段、A地址字段、C控制字段、协议
	2.IP数据报：信息部分。
	3.尾部：FCS F **3字节**

**字节填充**：(异步传输)
转义字符定义为**0x7D**，并使用字节填充，填充方法如下：
	1.将0x7E转变成0x7D，0x5E。
	2.将0x7D转变成0x7D，0x5D。
	3.若出现ASCII码的控制字符(即值小于0x20字符)，则要0x7D字符，然后将该字符的编码加以改变。

**零比特填充**：(SONET/SDH 同步传输时)
	**只要发现连续的5个1，则立即填入一个0**。

#### ppp协议的工作状态

![PPP协议状态图](E:\MarkDown_study\计算机网络\img\PPP协议状态图.png)

LCP开始协商一些**配置选项**，即发送LCP的**配置请求帧**。有以下几种响应：配置确认帧，配置否认帧，配置拒绝帧。
**鉴别状态**：口令鉴别协议PAP，口令握手协议CHAP。
**IP控制协议IPCP**
两个PPP端点还可发送**回送请求LCP分组** 和 **回送回答LCP分组**。
终止时，发出**终止请求LCP分组**。接收方发出**终止确认LCP分组**。

## 使用广播信道的数据链路层

#### 局域网的数据链路层

局域网最主要的**特点**：网络为一个单位拥有，且地理范围和站点数目均有限。
局域网优点：
	1.具有广播功能，共享资源。
	2.**设备的位置可灵活调整改变**。
	3.提高了系统的**可靠性**、**可用性** 和 **生存性**。
局域网按网络拓扑进行分类：
	星形网、星形网、总线网。
共享信道要着重考虑的一个问题就是如何使众多用户能够合理而方便地共享通信媒体资源。
	1.静态划分信道。
	2.动态媒体介入控制：又分为随机接入(**碰撞**，==以太网的开始==)、受控接入(多点线路**探询**)。

**以太网的两个主要标准**：
	DIX
	IEEE 802：把数据链路层拆成两个子层，**逻辑链路控制LLC子层**(已成为历史) 和 **媒体接入控制MAC**。

**适配器的作用**：
	适配器是**网络接口卡NIC**，简称为**网卡**。其装有 **存储器** 和 **处理器**。

#### CSMA/CD协议  改协议下以太网只能工作在半双工通信

**总线的特点**：一计算机发送数据时，总线上的所有数据都能检测到这个数据，这是一种广播通信方式。
在同一时间内只能允许一台计算机发送数据，当多个主机发送数据时会出现碰撞，为了解决这个问题，它使用的协议是CSMA/CD，意思是**载波监听多点接入**/**碰撞检测**。

多点接入：说明是总线型网络

载波监听：边发送边监听

碰撞检测：适配器检测带信号电压，当超过阈值表示发生碰撞。

知道是否碰撞需要多少时间：**两倍**的总线端到端的**传播时延**。

退避算法：
	1.基本退避时间为争用期2倍，具体争用期时间是**51.2us**，也就是**512比特时间**。
	2.离散的整数集合[0,1,...,2^k^ - 1]，中随机取出一个数，几为r。**重传应推后r倍的争用期**。 k = min[重传次数，10]。
	3.**重传16次**仍然不能成功时，则**丢弃该帧**，并向高层报告。

以太网规定一个最短帧长64字节，即512比特。**凡是长度小于64字节的帧是由于冲突而异常终止的无效帧**。

**强化碰撞**：发送数据的站一旦发现发生了碰撞时，除立即停止发送数据外，还要再继续发送32比特 或 48比特的**人为干扰信号**。

以太网还规定了帧间最小间隔为9.6us，相当于96比特时间，这样做是为了使刚刚收到数据帧的站的**接收缓存来得及清理**。

CSMA/CD协议的要点：
	1.**准备发送**：封装成帧，放入缓存。
	2.**检测信道**：检测信道**在96比特时间内信道保持空闲**，就发送这个帧。
	3.**边发送边监听**：若发送失败则**执行退避算法**。

#### 使用集线器的星形拓扑

**集线器的特点**：
	1.使用集线器的以太网在逻辑上仍然是一个总线网，各站共享逻辑上的总线，使用的还是CSMA/CD协议。
	2.一个集线器有许多端口。
	3.**集线器工作在物理层**，只进行简单地比特转发。
	4.集线器采用了专门的芯片，进行自适应串音回波抵消。

#### 以太网地信道利用率

要提高以太网地信道利用率，就必须减小Γ 与 T0之比，定义 **a = Γ / T0**。当数据一定时，以太网地**连线的长度受到限制**，同时**以太网地帧长不能太短**。==最大大约为1518字节==。
信道极限利用率Smax为：**Smax = T0 / (T0 + Γ) = 1 / (1 + a);**

#### 以太网的MAC层

**1.MAC层的硬件地址**
	硬件地址又称为 **物理地址** 或 **MAC地址**。每一台计算机中**固化在适配器的ROM中的地址**。
	注册管理机构RA：负责分配地址字段的6个字节的前3个字节，为组织**唯一标识符OUI**，也叫做司标识符。
	后三个字节又厂家自行指派， 称为**扩展标识符**，这种地址又称为**EUI-48**，表示**扩展的唯一标识符**。
	第一字节最低位：0为单个地址，1为组地址。第一字节的最低位：0为全球管理，1为本地管理。 
	发往本站的帧，包括以下三种帧：
		1.**单播帧** 2.**广播帧** 3.**多播帧**

**2.MAC帧格式**

![以太网V2的MAC帧格式](E:\MarkDown_study\计算机网络\img\以太网V2的MAC帧格式.png)

**前同步码**：使接收端的适配器在接受MAC帧时能够迅速**调整其时钟频率**，使它和发送端的时钟同步。
第二字段：**帧开始界定符**。

## 扩展的以太网

#### 在物理层扩展以太网

采用双绞线，使用光纤和一堆光纤调制解调器，物理层上扩展成**多级结构的集线器**。
这种==多级结构的集线器==以太网也带来了一些缺点：
	1.三个系的以太网通过集线器互连起来后就把三个碰撞域变成一个碰撞域，这时只要某系两个站在通信时所传送的数据会通过所有的集线器进行转发，使得**其他系的内部在这时都不能通信**。
	2.如果不同的系使用不同的以太网技术，那么就不可能用集线器将它们互连起来。

#### 在数据链路层扩展以太网

网桥在数据链路层扩展以太网，网桥对收到的帧根据其MAC帧的目的地址进行**转发** 和 **过滤**。

**交换式集线器**常称为**==以太网交换机==** 或第二层交换机，强调这种交换工作在**数据链路层**。

**以太网交换机的特点**
	实质是一个多端口网桥，一般采用**全双工方式**。相互通信的主机都独占传输媒体，无碰撞地传输数据。
	以太网交换机是一种即差即用的设备，其内部的**帧交换表**是通过**自学习算法**自动地逐渐建立起来的，这种交换表就是一个**内容可寻址存储器**。
	以太网交换器对收到的帧采用**存储转发方式**进行转发，但也有一些交换机采用直通的交换方式。

**以太网交换机的自学习能力**
	对收到帧，获取其来自的**端口**，**源MAC地址**以及**时间**，然后存储到交换表中，并且更具时间不断对其进行更新。
	但这种情况可能存在兜圈子的问题，因此IEEE制定了一个**生产协议树STP**，要点就是不改变网络的实际拓扑，但从逻辑上切断某些链路，使得一台主机到其他主机的路径时**无环路的树状结构**。

**从总线以太网到星形以太网**

​	随着以太网上站点数目的增多，总线结构以太网的可靠性下降。大规模集成电路以及专用芯片的发展，使得星形结构的以太网交换机可以做得既便宜又可靠。

#### 虚拟局域网

**一个以太网是一个广播域**，经常会出现大量的广播帧。在一个主机数量很大的以太网上传播广播帧，必然会**消耗很多的网络资源**。如果网络的配置出现了差错，就有可能发生广播帧在网络中无限制地兜圈子，形成了**”广播风暴“**。

以太网交换器出现后，我们可以很方便灵活地建立**虚拟局域网WLAN**。这样就把一个**较大的局域网**，**分割成为一些较小的局域网**，而每一个局域网时一个较小的广播域。

**定义**：VLAN是由一些局域网网段构成的与物理位置无关的逻辑组，而这些网段具有某些共同的需求。每一个VLAN的帧都有一个明确的标识符，指明发送这个帧的计算机属于哪一个**VLAN**。

虚拟局域网其实**只是局域网给用户提供的一种服务**，而不是一种新型局域网。虚拟局域网协议允许在以太网的帧格式中插入一个4字节的标识符，称为**VLAN标签**(4字节，前两个一般是0x8100)，用来**指明发送该帧的计算机属于哪一个虚拟局域网**。

连接两个交换机端口之间的链路称为**汇聚链路** 或 **干线链路**。

## 高速以太网

#### 100BASE-T 以太网

​	100BASE-T是在双绞线上传送100Mbit/s基带信号的星形拓扑以太网，仍然使用CSMA/CD协议，又称为快速以太网。

​	100Mbit/s的以太网采用的方法时保持最短帧长不变，一个网段最大长度是**100m**，其最短帧长仍然是**64字节**，即**512比特**。因此以太网争用期为**5.12us**，最小间隔现在是**0.96us**。

#### 吉比特以太网

​	**特点**：
​		1.允许**全双工** 和 半双工两种方式。2.使用IEEE 802.3协议规定的帧格式。 
​		3.半双工采用**CSMA/CD协议**，全双工不使用。4.与10BASE-T 和 100BASE-T技术兼容。

​	吉比特以太网仍然保持一个网段的最大长度100m，但采用了”**载波延伸**“的办法，使用最短帧长仍然为64字节，同时将争用期扩大到512字节，填充448字节。吉比特以太网还增加了一种功能称为**分组突发**(**第一个采用载波延伸**，随后的一些短帧**可一个接一个地发送**，之间**只需要留必要的帧间最小间隔即可**。这样可以形成一串分组突发，直到1500字节或稍多为止)。

#### 10吉比特以太网和 更快的以太网

10GbE地帧格式与前面地帧格式完全向相同，保留了以太网**最小帧长**和**最大帧长**。
10GbE**只工作在全双工方式**，因此不存在争用问题，当然也不使用CSMA/CD协议。

**以太网的优点**：
	可扩展性、灵活的、易于安装、稳健性好。

#### 使用以太网进行宽带接入

以太网接入的重要特点是：它可以提供双向的带宽通信，并且可以根据用户对带宽的需求灵活地进行带宽升级。

以太网地帧格式标准中，在**地址字段部分并没有用户名字段**，也没有让用户键入密码来鉴别用户身份的过程。
为了解决这问题，有人把数据链路层的两个成功的协议结合起来，即把PPP协议中的PPP帧再封装到以太网中来传输，即PPPoE。
