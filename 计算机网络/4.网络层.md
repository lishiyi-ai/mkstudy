## 网络层的几个重要概念

#### 网络层提供的两种服务

<<<<<<< HEAD
​	可靠性，连接的建立，重点地址，分组的转发，节点故障，分组的顺序，端到端的差错处理和流量控制

​	1.面向连接的通信方式(**虚电路服务**)： 7 个点
​		可靠通信由网络来保证，
​		建立连接的，
​		只在建立连接阶段使用目的地址，每个分组使用短的虚电路号，
​		同一电路的分组均按同一路由转发，
​		当结点出现故障时，不能再工作，
​		总是按顺序到达终点，
​		差错处理和流量控制由网络负责，也可以由主机负责。 
​	2.无连接的尽最大努力交付的**数据报服务**： 7 个点
​		可靠通信应当由用户主机来保证，
​		不需要连接，
​		每个分组都有完整的终点地址，
​		每个分组独立查找表进行转发，
​		出故障的节点可能会丢失分组，路由可能会发生变化
​		到达终点的顺序不一定，
​		用户主机负责差错控制 和 流量控制和目的主机之间所传送的数据。

#### 两个层面

路由器之间传送的信息有两类：
	第一类：**转发源主机和目的主机之间所传送的数据**。(**数据层面**)
	第二类：**传送路由信息**，在路由器中创建路由表，由此**导出为转发分组而用的转发表**。(**控制层面**)

网络层抽象地划分为 **数据层面** 和 **控制层面** 。因此路由器划分为 **路由选择** 和 **分组转发** 两个大部分。

后来网络界提出了**软件定义网络SDN**，在网络的控制层面有一个在逻辑上集中的远程控制器，

## 网际协议IP

​	网际协议IP是TCP/IP体系中两个最主要的协议之一。与协议IP配套使用的还有三个协议：
​		**地址解析协议ARP**，**网际控制报文协议ICMP**，**网际组管理协议IGMP**。

#### 虚拟互联网络

​	没有一种单一的网络能够适应所有用户的需求。
​	网络相互连接起来要使用一些中间设备。主要分为：
​		1.物理层的**转发器**。
​		2.数据链路层的**网桥**或**桥接器**，以及**交换机**。
​		3.网络层的**路由器**。
​		4.网络层以上的叫做**网关**。
​	由于参加互连的计算机网络都是用相同的**网际协议IP**，因此可以把互连以后的计算机网络看出一个**虚拟互联网络**。我们利用协议IP就可以使这些性能各异的网络**在网络层上看起来好像一个统一的网络**。
​	直接交付：不经过任何路由器。间接交付：在查表转发后，将数据报交给其他路由器转发。
​	**互联网可以由多种异构网络互联组成**。

#### IP地址

​	1.IP地址及其表示方法：IP地址现在由互联网名字和数字分配机构ICANN进行分配。
​		**IP地址 ::={<网络号>, <主机号>}** 网络号**n**位，主机号**(32 - n)**位
​	2.**分类IP地址**
​		A类(0 n = 8)，B类(10 n = 16)，C类(110 n = 24)，D类(1110 n = 16)，E类(1111 保留地址)。
​	3.**无分类编址CIDR**：无分类域间路由选择CIDR。
​		**网络前缀**：即网络号，**IP地址 ::={<网络前缀>, <主机号>}**，使用**斜线记法**。
​		**地址块**：CIDR把网络前缀相同的所有连续的IP地址组成一个地址块。
​		**地址掩码**：由一连串1 和 接着一连串的0 组成，CIDR记法，**斜线后面的数字就是地址掩码中1的个数**。
​		CIDR地址中还有**三个特殊地址块**：
​			前缀 n = 32 用于**主机路由**；
​			前缀 n = 31 ，用于**点对点链路**；
​			前缀 n = 0 同时IP地址全是0，**默认路由**。
​			路由聚合：利用较大的一个CIDR地址块来代替许多较小的地址块。
​	4.**IP地址的特点**

#### IP地址与MAC地址

#### 地址解析协议ARP

​	地址解析协议ARP 解决这个问题的方法是在**主机上的ARP高速缓存中存放一个从IP地址到MAC地址的映射表**。
​	ARP用于解决**同一局域网上**的主机或路由器的IP地址和MAC地址的映射。

#### IP数据报的格式(20最小)

​	(1) **版本**：占4位，指协议IP的版本。
​	(2) **首部长度**：占4位，单位是32位字长(4字节)，最长61字节。
​	(3) **区分服务**：占8位，表示服务类型。
​	(4) **总长度**：首部和数据之和的长度，单位为字节。（不超过576字节）
​	(5) **标识**：占16位，可以用于重装成原来的数据报。
​	(6) **标志**：最低位 MF = 1 表示 “还有分片”，中间位 DF = 1 表示 “不能分片”。
​	(7) **片偏移**：某片在原分组中的相对位置，片偏移以**8字节位为偏移单位**。
​	(8) **生存时间**：占8位，(表示最多的跳数)。
​	(9) **协议**：占8位，表示使用的协议。
​	(10) **首部检验和**：占16位，**只检验数据包首部**，**不包括数据部分**。
​	(11) **源地址**：占32位，发送方IP地址。
​	(12) **目的地址**：占32位，接收方IP地址。
​	**IP数据报首部的可变部分**，用来支持**排错**，**测量**以及**安全**等措施。

## IP层转发分组的过程

#### 基于终点的转发

​	分组在互联网上 **传送** 和 **转发** 是**基于分组首部的目的地址**。

#### 最长前缀匹配

​	在采用CIDT编址时，如果一个分组在转发表中可以找到多个匹配的前缀，那么就应当选择前缀最长的作为匹配的前缀。

#### 使用二叉线索查找转发表

## 网际控制报文协议ICMP

#### ICMP报文格式

​	类型，代码，检验和

#### ICMP报文的种类

**ICMP差错报告报文**
	终点不可达(3)，时间超过(11)，参数问题(12)，改变路由(5)

 **ICMP询问报文**
	回送请求或会送回答(8 或 0)，时间戳请求或时间戳回答(13 或 14)

#### 应用举例

​	ping软件

## IPv6

#### IPv6的基本首部

​	(1) **版本**：占4位。
​	(2) **通信类型**：占8位。
​	(3) **流标号**：占20位。
​	(4) **有效载荷长度**：占16位，表示**除了基本首部以外的字节数**。
​	(5) **下一个首部**：占8位，相当于IPv4的协议字段或可选字段。
​	(6) **跳数限制**：占8位。
​	(7) **目的地址**：32位。
​	(8) **源地址**：32位。
​	六种扩展首部：逐跳选项，路由选择，分片，鉴别，封装安全有效载荷，目的站选项。

#### IPv6的地址

​	(1) **单播**：点对点通信。
​	(2) **多播**：一对多的通信。
​	(3) **任播**：**任播的终点时一组计算机**，但**数据报只交付其中的一个**，通常是按照路由算法得出距离最近的一个。
​	IPv6使用**冒号十六进制法**。几种常用地址简单解释如下：
​		未指明地址，回环地址，多播地址，本地站点单播地址，本地链路单播地址，全球单播地址。

#### 从IPv4向IPv6过渡

​	1.**双协议栈**
​		一部分主机同时装有 IPv4 和 IPv6 这两种协议栈，使用DNS来查询识别使用哪一种协议。
​	2.**隧道技术**
​		在IPv6数据报要进入IPv4网络时，把IPv6数据报封装成为IPv4数据报。

#### ICMPv6

​	ICMPv6合并了 **地址解析协议ARP** 和 **网际组管理协议IGMP**。
​	ICMPv6时面向报文的协议，它利用报文来报告差错，获取信息，探测邻站(DN

协议)，管理多播通信(MLD协议)。

## 网络的路由选择协议

#### 有关路由选择协议的几个基本概念

​	1.理想的路由算法
​	2.分层次的路由选择
​		内部网关协议 IGP(RIP，OSPF)，外部网关协议EGP(BGP-4)，边界网关协议BGP。

#### 内部网关协议RIP 基于矢量的

​	**特点**：
​		1.**仅和相邻路由器交换信息**。
​		2.路由表交换的信息是**当前本路由器所知道的全部信息**，**即自己现在的路由表**。
​		3.**按固定的时间间隔交换路由信息**。
​	**距离向量算法**。**坏消息传播得慢，好消息传播的快**。实现简单，开销较小。

#### 内部网关协议OSPF 链路状态路由协议 

​	**特点**：
​		1.向本自治系统中**所有路由器**发送信息。使用的是**洪泛法**。
​		2.发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。
​		3.当链路状态发生变化或每隔一段时间，路由器向所有路由器用洪泛法发送链路状态信息。
​	所有的路由器都能建立一个**链路状态数据库**，这个数据库**实际上就是全网络的拓扑**。OSPF的更新过程收敛的快。
​	**OSPF的五种分类**：
​		1.类型1，问候分组 2.类型2，数据库描述分组 3.类型3，链路状态请求 4.类型4 链路状态更新分组 
​		5.类型5，链路状态确认分组。

#### 外部网关协议BGP

​	协议BGP的**主要特点**：力求选择出一个**能够到达目的的网络前缀且比较好的路由**。BGP采用了**路径向量路由选择协议**。
​	**BGP路由**：
​		自治系统AS中由两种不同功能的路由，即 **边界路由器** 和 **内部路由器**。
​		两个边界路由器进行通信时，必须先建立TCP连接，沉稳给eBGP。AS内部，两个路由器之间需要建立iBGP ，一个AS内部所有iBGP必须是全连通的。
​		BGP路由 = “前缀，BCP属性” = “前缀，AS-PATH, NEXT-HOP”
​	**三种不同的自治系统AS**：
​		末梢AS：将分组转发给直连的AS 或 从直连AS接收分组，不会把来自其他的AS转发。
​		穿越AS：为其他的AS有偿转发分组。
​		对等AS：事先协商的两个AS，彼此之间的发送或接收分组都不收费。
​	**BGP的路由选择**：
​		1.**本地偏好值最高**的路由首要选择。
​		2.选择具有**AS跳数最少**的路由。
​		3.热土豆路由选择算法(选择尽快离开本地AS的路径)。
​		4.选择路由器**BGP标识符的数字最小**的路由。
​	**BGP的四种报文**：
​		OPEN打开报文，UPDATE更新报文，KEEPALIVE保活报文，NOTIFICATION通知报文。

#### 路由器的构成

​	路由器的结构划分为两大部分：**路由选择部分** 和 **分组转发部分**。
​		路由选择部分也叫控制部分，核心构件是**路由选择处理器**。
​		分组转发部分也是数据部分，由交换结构，一组输入端口，一组输出端口。
​		交换结构：通过存储器，通过总线，通过互联网路。

## IP多播

#### IP多播的基本概念

#### 在局域网上进行硬件多播

#### 网际组管理协议IGMP 和 多播路由选择协议

​	**IGMP协议**是让连接在本地局域网上的多播路由器知道本局域网上是否有主机参与或推出到某个多播组中。
​	多播转发必须**动态地适应多播组成员的变化**(这时网络拓扑并未发生变化)
​	多播路由器在转发多播数据报时，**不能仅仅根据多播数据包中的目的地址**。
​	**多播数据报可以由没有加入多播组主机发出**，**也可以通过没有组成员接入的网络**。
​	**多播路由选择协议**：
​		1.洪泛与剪除 2.隧道技术 3.基于核心地发现技术
​		建议使用的多播路由选择协议

## 虚拟专用网VPN和网络地址转换NAT

#### 虚拟专用网VPN

三个地址块：

​	10.0.0.0/8 A类地址
​	172.16.0.0/12 B类地址
​	192.168.0.0/16 C类地址
解决两个部分之间地交换信息：
​	1.隧道技术，2.构成虚拟专用网络


#### 网络地址转换NAT

​	NAT转换表：将专用网地址 转换成 全球IP地址，使用端口号地NAT也叫作网络地址与端口号转换NAPT。

## 多协议标签交换MLPS

​	MPLS利用面向连接计数，使每个分组携带一个叫做标签地小证书，当分组到达交换器时，交换机读取分组标签，并由标签值来检索分组转发表，这比查找路由表来转发分组快得多。
​	MPLS特点：支持面向连接地服务质量，支持流量工程均衡网络负载，有效支持虚拟专用网络VPN。
​	转发等价类FEC用于负载均衡。
​	MPLS首部位置与格式
​		帧首部与IP首部之间：由标签值(20位)，试验(3位)，S(1位)，生存时间TTL组成(8位)。
=======
## 网际协议IP

## IP层转发分组的过程

## 网际控制报文协议ICMP

## IPv6

## 网络的路由选择协议

## IP多播

## 虚拟专用网VPN和网络地址转换NAT

## 多协议标签交换MLPS

>>>>>>> 6f37266fd4d2ab2f34d4870862266a22f8f74bf8
