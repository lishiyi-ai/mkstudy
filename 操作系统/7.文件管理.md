## 文件和文件系统

#### 数据项、记录和文件

**1.数据项**
**基本数据项：**用于描述一个对象的某种属性的字符集，是数据组织中可以命名的最小逻辑数据单位。包括数据名，数据类型。

**组合数据项：**是由若干个**基本数据项组成**的，简称组项。

**2.记录**
记录是一组**相关数据项的集合**，用于描述一个对象在某方面的属性。
在诸多记录中，为了能唯一地标识一个记录，必须在一个记录的各个数据项中**确定出一个或几个数据项**，**把它们的集合称为关键字**。

**3.文件**
文件是指由创建者所定义的、具有文件名的**一组相关元素的集合**，可分为有结构文件和无结构文件两种。
**有结构文件：**文件由若干个相关记录组成；**无结构文件：**被看成是一个而字符流。
文件在文件系统中是一个**最大的数据单元**，描述成一个对象集。
**文件属性：**
	①文件类型②文件长度③文件的物理位置④文件的建立时间

#### 文件名和类型

**1.文件名和扩展名**
	在不同的系统之间，对文件名的规定是不同的，在一些老的系统中，名字的长度受到限制。
	**扩展名**：添加在文件名后的若干个附加字符，又称为后缀名，用于指示文件的类型。

**2.文件类型**
**①按用途分类：**
	系统文件、用户文件、库文件
**②按文件中的数据形式分类：**
	源文件、目标文件(.obj)、可执行文件
**③按存取控制属性分类：**
	只执行文件、只读文件、读写文件
**④按组织形式和处理方式分类：**
	普通文件、目录文件、特殊文件(各类I/O设备)

#### 文件系统的层次结构

文件系统的模型可分为三个层次：最底层是**对象及其属性**，中间层是**对对象进行操纵和管理的软件集合**，最高层是**文件系统提供给用户的接口**。

**1.对象及其属性**
①文件：文件管理的直接对象。
②目录：方便用户和提高对文件存取速度的关键。
③磁盘存储空间：提高外村利用率，提高文件的存取速度。

**2.对对象操纵和管理的软件的集合**
文件系统的功能大多在这一层实现，包括：
	①对文件**存储的管理**②对文件目录的管理③将文件的**逻辑地址转换为物理地址的机制**
	④对文件的**读和写的管理**⑤对文件的**共享与保护的功能**
一般把与文件系统有关的软件分为四个层次：
	①I/O控制层②基本文件系统③基本I/O管理程序④逻辑文件系统

**3.文件系统的接口**
	**①命令接口：用户与文件系统直接交互的接口**，用户可通过键盘终端键入命令取得文件系统的服务。
	**②程序接口：**是指作为**用户程序与文件系统的接口**，用户程序可以通过系统调用 取得文件系统的服务。

#### 文件操作

**1.最基本的文件操作**
	创建文件，删除文件，读文件，写文件，设置文件的读/写位置。

**2.文件的“打开” 和 “关闭“操作**
**打开：**是指系统将文件的属性，从外存拷贝到内存打开文件表的一个表目中，并将该表目的编号，返回给用户。
**关闭：**OS将会把该文件从打开文件表的表目上删除掉。

**3.其它文件操作**
	一类是：**有关文件属性的操作**，即允许用户直接设置或获得文件的属性。
	另一类是：**有关目录的操作**，创建一个目录，删除一个目录，改变当前目录和工作目录等。

## 文件的逻辑结构

文件的逻辑结构：从用户观点出发所观察到的文件组织形式，即文件是由一系列的逻辑记录组成。
文件的物理结构：系统将文件存储在外村上所形成的一组存储组织形式，使用户不能看见的。

#### 文件逻辑结构的类型

**1.按文件是否有结构分类**
**有结构文件**：
	定长记录，边长记录；
**无结构文件**：
	流式文件，文件的长度是以字节为单位的。一个记录仅有一个字节。 

**2.按文件的组织方式分类**
**顺序文件**：由一系列记录按某种顺序排列所形成的文件。
**索引文件**：为可边长记录文件建立一张索引表，为每个记录设置一个表项，加速对记录的检索速度。
**索引顺序文件**：为每个文件建立一张索引表时，并不是为每一个记录建立一个索引表项，而是为**一组记录的第一记录建立一个索引表项**。

#### 顺序文件

**1.顺序文件的排列方式**
	串结构(按时间)，顺序结构
**2.顺序文件的优缺点**
	**优点**：最佳应用场合时在对文件中的记录进行批量存取时。
	**缺点**：
		用户想要求查找或修改单个记录，性能可能很差。
		如果想增加或删除一个记录都比较困难。

#### 记录寻址

**1.隐式寻址方式**
	对于定长记录的顺序文件，如果已知当前记录的逻辑地址，便很容易确定下一个记录的逻辑地址。这种顺序访问的方式可用于所有文件类型，其主要问题是：访问一个指定记录i，必须扫描或读取前面第0到 i-1个记录，访问速度慢。

**2.显式寻址方式**
	该方式用于对定长记录的文件实现**直接或随机访问**。①通过**文件中记录的位置**。②**利用关键字**。

#### 索引文件

**1.按关键字建立索引**
	为边长记录文件**建立一张索引表**，为主文件中的**每个记录在索引表中分别设置一个表项**，**记录指向记录的记录的指针以及记录的长度L**，索引表按关键字排序，因此其本身也是一个定长记录的顺序文件，这样就**把对变长记录顺序文件的顺序检索转变为对定长记录索引文件的随机访问**。

**2.具有多个索引表的索引文件**
	不同的用户，为了不同的目的，希望能按不同的属性来检索一条记录。因此需要**为顺序文件建立多个索引表**，即为**每一种可能称为检索条件的域都配置一张索引表**。
	**优点**：将一个需要顺序查找的文件改造成一个可随机查找的文件，极大提高了对文件的查找速度。同时利用索引文件插入和删除记录也非常方便。
	**缺点**：增加了额外的开销

#### 索引顺序文件

**1.索引顺序文件的特征**
	一个是引入了文件索引表，另一个是增加了溢出文件，用它来记录新增加的、删除的和修改的记录。

**2.一级索引顺序文件**
	只是用了一级索引。首先将边长记录顺序文件中的**所有记录分为若干组**，然后为顺序文件建立一张索引表，并**为每组中的第一个记录在索引表中建立一个索引项**，其中含有**该记录的关键字和指向该记录的指针**。

**3.两级索引顺序文件**
	对于一个非常大的文件，可以为顺序文件建立多级索引，即为索引文件在建立一张索引表，从而形成两级索引表。

#### 直接文件和哈希文件

**1.直接文件**
	对于直接文件，则可根据给定的关键字直接获得指定记录的物理地址。换言之，关键字本身就决定了记录的物理地址。

**2.哈希文件**
	它利用**Hash函数可将关键字转换为相应记录的地址**，但为了实现文件存储空间的**动态分配**，通常由Hash函数所求得的并非是相应记录地址，而是**指向某一目录表相应表目的指针**。

## 文件目录

目录管理的要求如下：
	①实现：“**按名存取**”②提高对目录的**检索速度**③文件**共享**④允许文件**重命名**。

#### 文件控制块和索引结点

**1.文件控制块FCB**
基本信息类：文件名，文件物理位置，文件逻辑结构，文件的物理结构

存取控制类：文件主的存取权限，核准用户的存取权限，一般用户的存取权限。

实用信息类：文件的建立日期和时间、文件上次修改的日期和时间，以及当前使用信息。

**2.索引节点**
**索引结点的引入：**
	减少启动磁盘次数，节省系统开销。其它一些对该文件进行描述的信息在检索目录时一概不用。**因此可以采用文件名和文件描述信息分开的办法，减少文件描述信息调入内存所带来的开销**。采用文件名和索引节点编号的形式。

**磁盘索引结点：**
	每个文件都有唯一的一个磁盘索引结点，主要包括：①文件主标识符②文件类型③文件存取权限④文件物理地址⑤文件长度⑥文件连接技术⑦文件存取时间。

**内存索引结点：**
	在磁盘结点基础上增加了：①索引结点编号②状态③访问计数④文件所属文件系统的逻辑设备号⑤链接指针(指向空闲链表和散列队列的指针)。

#### 简单的文件目录

**1.单级文件目录**
缺点：
	①查找速度慢②不允许重名③不便于实现文件共享。

**2.两级文件目录**
特点：
	①提高了检索目录的速度②在不同的用户目录中，可以使用相同的文件名。③不同用户还可**使用不同的文件名访问系统中的同一个共享文件**。

#### 树形结构目录

**1.树形目录：**明显地提高对目录地检索速度和文件系统的性能。

**2.路径名和当前目录**
路径名：从根目录到任何数据文件都只有一条唯一地通路。把全部目录文件名与数据文件名依次用"/"连接起来，就是路径名
当前目录：进程运行所访问的空间往往局限于某个范围。可以为每个进程设置一个“当前目录”，又称“工作目录”

**3.操作目录**
	①创建目录②删除目录③不删除非空目录④可删除非空目录⑤改变目录⑥移动目录⑦链接操作⑧查找

#### 目录查询技术

**1.线性检索发**

**2.Hash方法**
一种处理“冲突”的有效规则：
	①如果目录表中相应的目录项为哦个，则表示系统中并无指定文件。
	②若目录项中的文件名与指定文件名相匹配，则表示该目录正式所寻目录。
	③若文件名不匹配，这采用Hash值加上一个常数(该常数英语目录的长度值互质)，新城新的索引值，重新开始查找。

## 文件共享

#### 基于有向循环图图实现文件共享

**1.有向无循环图DAG**
	树形结构目录不利于共享，为了利于共享我们允许一个文件可以有多个父目录。

**2.利用索引结点**
	为了解决：如何建立父目录与共享文件之间的链接。并保证后续操作是大家都可见的。引用了索引结点，诸如文件的物理地址及其它的**文件属性等信息**， 不再是放在目录项中，而是**放在索引结点中**。文件目录中只设置**文件名及指向相应索引结点的指针**。

#### 利用符号链接实现文件共享

**1.利用符号链接实现文件共享**
	允许一个文件或子目录有多个父目录，但其中仅有一个作为主父目录，其它的几个父目录都是通过符号链接方式与之相链接。

**2.如何利用符号链接实现共享**
	由系统创建一个LINK类型的新文件，也取名为F，并将F写入链接父目录中，以实现文件的链接。

**3.利用符号链接实现共享的优点**
	利用符号链接方式实现文件共享，只是主文件才拥有指向其索引结点的指针；不会发生文件主删除一共享文件后留下选空指针的情况。

**4.利用符号链接的共享方式存在的问题**
	当其他用户去读共享文件时，是根据给定的文件路径逐个分量地区查找目录，直至找到该文件的索引结点。每次访问文件的开销甚大。
	每次链接需要建立一个符号链接，其本身实际上也是一个文件，需要为他配置一个索引节点 ，会耗费一定磁盘空间。

## 文件保护

影响文件安全性的主要因素：人为因素，系统因素，自然因素。
为保证安全性，可采取的三方面措施：
	①存取控制机制。②系统容错技术。③建立后备系统。 

####  保护域

操作系统规定每个进程仅能在“保护域”内执行操作，而且只允许进程访问它们具有“访问权”的对象。

**1.访问权**
	为了对系统中的对象加以保护，应由操作系统来控制进程对对象的访问。

**2.保护域**
	为了对系统中的资源进行保护引入了保护域的概念，“域”时进程对一组对象访问权的集合，进程只能在指定域内执行操作。

**3.进程与域间的静态联系**
	进程与域之间可以一一对应，即一个进程只联系着一个域。

**4.进程与域间的动态联系**
	在进程和域之间，也可以是一对多的关系，即一个进程可以联系着多个域。

#### 访问矩阵

**1.基本的访问矩阵**
	我们可以利用一个**矩阵来描述系统的访问控制**，并成为访问矩阵。行代表域，列代表对象。

**2.具有域切换权的访问矩阵**
	为了实现在进程和域之间的动态联系，应能够将进程从一个保护域切换到另一个保护域。在访问矩阵中**又增加了几个对象(域对象)**，分别把它们作为访问矩阵中的几个域。

#### 访问矩阵的修改

**1.拷贝权**：拷贝权可以将某个域中所有的访问全扩展到同一列的其它域中。

**2.所有权**：人们不仅要求能把已有的访问权进行有控制的扩散，而且同样需要能增加某种访问权，或能删除某种访问去哪。

**3.控制权**：拷贝权和所有权用于改变在**不同域中运行的进程对同一对象的访问权**。控制权则用于改变矩阵内同一行中的各项访问权限，用于改变在**某个域中运行的进程对不同对象的访问权限**。

#### 访问矩阵的实现

**1.访问控制表**
	对**访问矩阵按列划分**，为**每一列建立一张访问控制表ACL**。该表中，把矩阵属于该列的所有空项删除，此时的访问控制表是由一有序对(域，权集)所组成。

**2.访问权限表**
	把**访问矩阵按行划分**，便可由**每一行构成一张访问权限表**。这是由一个域对每个对象可以执行的一组操作所构成的表。
	仅当访问权限表安全时，由它所保护的对象才可能是安全的。
进程先访问控制表，再访问权限表。控制表用户不能直接访问，只能由操作系统进行操作。
