## 进程的描述

#### 进程的定义和特征

​	**定义**：进程式进**程实体的运行过程**，是系统进行**资源分配**和**调度**的**一个独立单位**。
​	**特征**：进程有相应的**进程控制块PCB**
​		(1) **动态性**：进程的实质是进程实体的执行过程。
​		(2) **并发性**：**多个进程实体**同存与内存中，且能在**一段时间内**同时运行。
​		(3) **独立性**：进程实体是一个能**独立运行**、**独立获得资源**和**独立接受调度**的基本单位。
​		(4) **异步性**：进程是按**异步方式运行**，即**按各自独立的**、**不可预知的速度**向推进。

#### 进程的基本状态及转换

​	1.进程的**三种基本状态**：(1) **就绪状态** (2) **执行状态** (3) **阻塞状态**
​	2.进程的创建状态和终止状态：(1) **创建状态** (2) **终止状态**

#### 进程的挂机操作和进程状态的转换：

​		(1) **静止就绪** (2) **静止阻塞**
​		引起挂起操作的原因：1.**终端用户的需要**2.**父进程请求**3.**负荷调节的需要**4.**操作系统的需要**

#### 进程管理中的数据结构

​	**1.操作系统中用于管理控制的数据结构**
​		OS管理的这些数据结构一般分为4类：
​			**内存**、**设备**、**文件**、**进程**(进程的标识、描述、状态等信息以及一批指针)。
​	**2.进程控制块PCB的作用**
​		(1) 作为**独立运行基本单位的标志**。
​		(2) 能够**实现间断性运行方式**。
​		(3) 提供**进程管理**所需的信息。
​		(4) 提供**进程调度**所需要的信息。
​		(5) 实现与其他**进程的同步与通信**。
​	**3.进程控制块中的信息**
​		(1) 进程标识符：包括 **外部标识符** 和 **内部标识符**。解决识别问题。
​		(2) 处理机状态：处理机的上下文，包括**通用寄存器**，**指令计数器**，**程序状态字PSW**，**用户栈指针**
​		(3) 进程调度信息：包括内容有**进程状态**，**进程优先级**，**进程调度所需的其他信息**，**事件**
​		(4) 进程控制信息：包括**程序和数据的地址**，**进程同步和通信机制**，**资源清单**，**链接指针**(指向下一个进程的PCB)
​	**4.进程控制块的组织方式**
​		(1) 线性方式 (2) 链接方式

## 进程的控制

#### 操作系统内核

现代操作系统一般将**OS划分为若干个层次**，再将OS的不同功能分别设置在不同的层次中。这种安排方式的**目的在于两个方面**：
	**1.便于对这些软件进行保护，防止遭受其他应用程序的破坏。**
	**2.提高OS的运行效率。**

通常处理机的执行状态分成**系统态**和**用户态**两种：
	1.**系统态**：又称管态，也称内核态，由较高特权，能执行一切指令，访问所有寄存器和存储区。
	2.**用户态**：又称目态。具有较低特权的执行状态，仅能执行规定的指令，访问指定的寄存器和存储区。

大多数OS内核都包含了以下两个大方面的功能：
	**1.支撑功能**：
		中断处理，始终管理，原语操作。
	**2.资源管理功能：**
		进程管理，存储器管理，设备管理。

#### 进程的创建

1.进程的层次结构
	OS中，允许一个进程创建另一个进程，通常把创建进程的进程称为父进程，而把被创建的进程称为子进程。进程通过**句柄**来控制。

2.进程图

**3.引起创建进程的事件**
	用户登录、作业调度、提供服务，应用请求。
**4.进程的创建**
	①申请空白PCB②为新进程分配器运行所需的资源，包括物理和逻辑资源③初始化进程控制块④等待就绪队列接纳。

#### 进程的终止

**1.引起进程终止的事件**
	正常结束、异常结束、外部干预。
**2.进程的终止过程**
	①根据终止进程的标识符查找对应PCB②若其处于执行态，则终止其执行，并置调度标志为真，表示被终止后重新进行调度。
	③终止其子进程④将所有资源归还给系统⑤将PCB从队列中移出，等待其他程序来搜集信息

#### 进程的阻塞与唤醒

**1.引起进程阻塞和唤醒的事件**
	请求共享资源失败，等待某种操作完成，新数据尚未到达，等待新任务的道道。
**2.进程阻塞的过程**
	调用阻塞原语block，将PCB转到阻塞队列，保留被阻塞进程的处理机状态，设置新进程的PCB中处理机状态。
**3.进程唤醒的过程**
	调用唤醒原语wakeup，将阻塞进程冲阻塞队列移出，再将其保存到就绪队列中。

#### 进程的挂起与激活

**1.进程的挂起**
	OS利用原语suspend指定进程或处于阻塞状态的进程挂起。
**2.进程的激活**
	OS利用原语active，将指定进程激活，激活原语先将进程从外存调入内存，修改其现行状态，并设置其调度。

## 进程的同步

#### 基本概念

​	**1.两种形式的制约关系**
​		(1) 间接相互制约关系：由于**共享资源**导致**并发执行的程序**之间形成**相互制约**的关系 
​		(2) 直接相互制约关系：为了某一任务创建的两个或多个进程，它们**为完成同一项任务而相互合作而导致的相互制约**。
​	**2.临界资源**
​		 临界资源是**一次仅允许一个进程使用的共享资源**。各进程**采取互斥**的方式，实现共享的资源称作临界资源。
​		一个著名的进程同步问题：**生产者-消费者问题**。
​	**3.临界区** 
​	每个进程中**访问临界资源的那段代码称为临界区**（criticalsection），每次**只允许一个进程进入临界区**，进入后，不允许其他进程进入。不论是硬件临界资源还是软件临界资源，多个进程必须**互斥**的对它进行访问。
​	**4.同步机制遵信的规则**
​	(1) **空闲让进**：当临界区空闲时，应允许一个请求进入临界区的进程进入到临界区。
​	(2) **忙则等待**：当有进程进入临界区时，让其他进程等待。
​	(3) **有限等待**：保证请求访问的进程能够在有限时间内进入到自己的临界区。
​	(4) **让权等待**：进程不能进入临界区时，应立即释放处理机，避免“忙等”状态。

#### ==硬件同步机制==

​	1.**关中断** 2.利用**Test-and-Set指令实现互斥** 3.利用**Swap指令实现进程互斥**

#### ==信号量机制==

​	1**.整型信号量** 2.**记录型信号量** 3.**AND型信号量(只有1和0)** 4.**信号量集**

#### ==管程机制==

​	一个管程定义了**一个数据结构**和**能为并发进程所执行的一组操作**，这组操作能**同步进程**和**改变管理中的数据**。
​	在**管程中的进程可能也会因为某些原因导致阻塞挂起**，为了让他释放管程，需要通过**多个条件变量来进行管理**，对这些**条件变量的访问只能在管程中进行**。
​	管程由4个部分组成：管程名称，管程的数据结构说明，对该数据结构的操作，对共享数据设置初始值的语句

## 经典进程的同步问题

​	生产者-消费者问题

## ==进程的通信==

#### 进程通信的类型
​	1.**共享存储器**系统：包括**共享数据结构的通信方式** 和 **共享存储区的通信方式**
​	2.**管道(pipe)通信**系统：用于连接一个读进程和写进程以实现他们之间通信的一个共享文件，又叫**pipe文件**，提供三方面的协调能力：**互斥**、**同步**、**确定对方是否存在**
​	3.**消息传递**系统：包括**直接通信方式**(利用OS所提供的原语) 和 **间接通信方式**(通过共享中间实体)
​	4.**客户机-服务器**系统：
​		主要实现方法有：
​			(1) **套接字** ：包括 **基于文件**(基于本地文件类似于管程) 和 **基于网络** 
​			(2) **远程过程调用和远程方法调用RPC**。

#### 消息传递通信的实现方式

​	1.**直接消息传递系统**：直接通信原语、非对称寻址方式、消息的格式、进程的同步方式、通信链路
​	2.**信箱通信**：信箱的结构、信箱通信原语、信箱类型、公用邮箱、共享邮箱

#### 直接消息传递系统实例

​	1.**==消息缓冲队列通信机制的数据结构==**
​		消息缓冲队列通信机制中的数据结构、发送原语、接收原语。
==七种方式：==
​	管道 命名管道 消息队列 信号 信号量 套接字 共享存储

## 线程的基本概念

#### 线程的引入

​	线程是**调度**和**分派**的基本单位。**线程**是**CPU调度的最小单位**。

#### ==线程与进程的区别==

​	1.**调度的基本单位**：**同一进程内的线程切换不会引起进程切换**，**切换代价远小于进程**。
​	2.**并发性**：进程之间可以并发执行，而且在**一个进程中的多个线程之间亦可并发执行**，**不同进程中的线程也能并发执行**。
​	3.**拥有资源**：线程本身不拥有系统资源，**只拥有一点必不可少的、保证独立允许的资源**，如TCB，程序计数器、**保留局部变量**、少数状态参数和返回地址等。
​	4.**独立性**：同一进程中的不同线程之间的独立性比不同进程之间的独立性低得多。
​	5.**系统开销**：线程的创建与销毁开销远小于进程，**线程的切换、同步和通信都无需操作系统内核干预**。
​	6.**支持多处理机系统**：一个进程的多线程可以分配到多个处理机上。

#### 线程的状态和线程的控制块

​	线程运行的三个状态：**执行状态**，**就绪状态**、**阻塞状态**
​	线程控制块TCB
​	多线程OS中的进程属性

## 线程的实现

#### 线程的实现方式

**1.内核支持线程KST**
**优点：**
	①多处理器系统中，内核能够同时调度同一进程中的多个线程，并行执行。
	②进程中一个线程被阻塞了，内核可以调度该进程中的其他线程占有处理器运行，也可以运行其他进程的线程。
	③线程的切换较快，切换的开销小。
	⑤内核本身也可以采用多线程技术，提高系统的执行速度和效率。
**2.用户级线程ULT**
**优点：**
	①不需要转换到内核空间
	②调度算法可以是进程专用的
	③用户级线程的实现与平台OS无关
**缺点：**
	①系统调用**阻塞问题**。(内核不支持线程时，一个线程阻塞会导致进程中所有线程阻塞，支持时则不会)。
	②在**单纯的用户级线程实现方式**中，多线程应该不能利用多处理机进行多重处理的优点。
**==3.组合方式==**
**①多对一模型**
	用户线程映射到一个内核控制线程。
**②一对一模型**
	每一个用户线程映射到一个内核支持线程
**③多对多模型**
	许多用户线程映射到同样数量或更少数量的内核线程上。

#### ==线程的实现==

**1.内核支持线程的实现**
	系统在创建一个新进程时，便为它分配一个**任务数据区PTDA**，其中包括若干**线程控制块TCB**。当进程要创建一个线程，便为新县城分配一个TCB，将有关信息填入该TCB中，并为之分配必要的资源。若TCB空间已用完，可以重新申请分配新的TCB。
**2.用户级线程的实现**
**①==运行时系统==**一对多
	实质上时用于**管理和控制线程的函数(过程)的集合**，其中包括用于创建的撤销线程的函数，线程同步和通信函数，以及实现线程调度的函数等。
	用户级线程不能利用系统调用的。当线程需要系统资源时，是将该要求传送给运行时系统，运行时系统通过相应的系统调用来获得系统资源。
**②==内核控制线程==**一对一
	又称为**轻型进程LWP**。每一个进程可以拥有多个LWP，每个LWP都**有自己的数据结构**，LWP可以**共享进程所拥有的资源**，当一个用户级**线程运行时**， 只须将他**连接到一个LWP上**，使它具有内核支持线程的所有属性。
	LWP实现了内核与用户级线程之间的隔离，LWP把内核与用户级线程之间连接起来。
①+② 多对多。

#### 线程的创建和终止

**1.线程的创建**
	应用程序在启动时，通常仅有一个线程在执行， 人们把线程称为”初始化线程”，主要功能时用于创建线程。创建后返回一个线程的标识符。
**2.线程的终止**
	当一个线程完成了自己的任务后，或是线程在运行时出现异常情况而须被强行终止时，由终止线程通过调用相应函数进行终止。线程被终止后并不立即释放它所占有的资源，只有当进程中的其他线程执行了分离函数后，被终止的线程才与资源分离，此时的资源才能被其他线程利用。
